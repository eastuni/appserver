<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:aop="http://www.springframework.org/schema/aop" xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:p="http://www.springframework.org/schema/p" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
		http://www.es-code.com/schema/batchex http://www.es-code.com/schema/batchex/spring-batch-ex-2.1.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
		http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.1.xsd
		http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.1.xsd">


	<import resource="classpath:JobConfig.xml" />

<!--  	<job-component xmlns="http://www.es-code.com/schema/batchex"
		id="jobcomp" with-dependon="true">
		<base-package name="bankware.corebanking.deposit.transaction.batch">
			<include name="DpstAccrualPartitioner" />
			<include name="DpstAccrualForDemandProcessor" />
			<include name="DpstAccrualForDemandReader" />
			<include name="DpstAccrualForDemandTasklet" />
		</base-package>
	</job-component> -->


	<job id="DpstAccrualJobForDemand" xmlns="http://www.es-code.com/schema/batchex">
		<step id="DpstAccrualJob_Step01" next="DpstAccrualJob_Step02"
			xmlns="http://www.es-code.com/schema/batchex">
			<tasklet tm-datasource="CBB" ref="DpstAccrualForDemandTasklet" />
		</step>
		<step id="DpstAccrualJob_Step02" xmlns="http://www.es-code.com/schema/batchex">
			<partition step="DpstAccrualJob_Step02_l"
				partitioner="partitioner">
				<handler grid-size="1" task-executor="taskExecutor" />
			</partition>
		</step>
	</job>

	<step id="DpstAccrualJob_Step02_l" xmlns="http://www.es-code.com/schema/batchex">
		<tasklet tm-datasource="CBB">
			<chunk commit-interval="1000"
				processor="DpstAccrualForDemandProcessor" reader="DpstAccrualForDemandReader" writer="DpstAccrualJobWriter" />
		</tasklet>
	</step>
	
	<bean id="taskExecutor" class="org.springframework.core.task.SimpleAsyncTaskExecutor" />

	<bean id="DpstAccrualJobWriter" parent="WDelimited" scope="step">
		<property name="name" value="DpstAccrualJobWriter" />
		<property name="appendAllowed" value="true"></property>
		<property name="resource"
			value="file://#{jobExecutionContext[outpFileTrgt]}/#{jobExecutionContext[outpFileNm]}" />
		<property name="encoding" value="UTF-8" />
		<property name="lineAggregator">
			<bean class="bxm.batch.item.file.transform.LineOmmAggregator">
				<property name="encoding" value="UTF-8" />
				<property name="delimiter" value="|" />
				<property name="targetType"
					value="bankware.corebanking.deposit.transaction.batch.dto.DpstAccrualSkipOut" />
			</bean>
		</property>
	</bean>

</beans>

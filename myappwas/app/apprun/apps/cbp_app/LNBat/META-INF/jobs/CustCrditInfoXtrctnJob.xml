<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:aop="http://www.springframework.org/schema/aop" xmlns:tx="http://www.springframework.org/schema/tx"
    xmlns:p="http://www.springframework.org/schema/p" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
         http://www.es-code.com/schema/batchex http://www.es-code.com/schema/batchex/spring-batch-ex-2.1.xsd
         http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
         http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.1.xsd
         http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.1.xsd">

    <import resource="classpath:JobConfig.xml"/>
 
	<!--
	 *    작업명 : 고객신용정보추출
	 *    설  명 : 외부로 수신한 고객 정보 파일을 읽어 저장 후 상태 정보를 갱신하는 작업
	-->
    <job id="CustCrditInfoXtrctnJob" parent="parentJob" xmlns="http://www.es-code.com/schema/batchex">
		<!--
		 *    스텝명 : 대상 건 추출
		 *    설  명 : File 읽기/쓰기 예제
		-->
<!--         <step id="CustCrditInfoXtrctnJob_Step01" parent="parentStep" next="CustCrditInfoXtrctnJob_Step02"> -->
<!--             <tasklet tm-datasource="BXM"> -->
<!--             	<chunk commit-interval="10" reader="CustCrdtInfoXtrctnTrgtReader" processor="CustCrdtInfoXtrctnTrgtProcessor" writer="CustCrdtInfoXtrctnTrgtWriter" /> -->
<!--             </tasklet> -->
<!--         </step> -->

       <!--
		 *    스텝명 : 고객 상태 정보 변경
		 *    설  명 : DB 읽기/쓰기 예제
		-->
        <step id="CustCrditInfoXtrctnJob_Step02" parent="parentStep">
            <tasklet tm-datasource="BXM">
            	<chunk commit-interval="10" reader="CustCrdtInfoXtrctnUpdtReader" processor="CustCrdtInfoXtrctnUpdtProcessor" writer="CustCrdtInfoXtrctnUpdtWriter" />
            </tasklet>
        </step>

       <!--
		 *    스텝명 : 고객 정보 발송
		 *    설  명 : tasklet 예제
        -->		
<!--         <step id="CustCrditInfoXtrctnJob_Step03" parent="parentStep" next="CustCrditInfoXtrctnJob_Step04"> -->
<!--         	<tasklet ref="CustCrdtInfoXtrctnSnd"/> -->
<!--         </step> -->
        
       <!--
		 *    스텝명 : 대외 전송용 파일 생성
		 *    설  명 : File 읽기/쓰기 예제(Header, Trailer)
		-->        
<!--         <step id="CustCrditInfoXtrctnJob_Step04" parent="parentStep" next="CustCrditInfoXtrctnJob_Step05"> -->
<!--             <tasklet tm-datasource="BXM"> -->
<!--             	<chunk commit-interval="10" reader="CustCrdtInfoXtrctnCmpxReader" processor="CustCrdtInfoXtrctnTrgtProcessor" writer="CustCrdtInfoXtrctnCmpxWriter" /> -->
<!--             </tasklet> -->
<!--         </step> -->
        
       <!--
		 *    스텝명 : 고객 일괄 반영
		 *    설  명 : C/C 예제
		-->        
<!--         <step id="CustCrditInfoXtrctnJob_Step05" parent="parentStep" next="CustCrditInfoXtrctnJob_Step06"> -->
<!--             <tasklet tm-datasource="BXM"> -->
<!--             	<chunk commit-interval="10" reader="CustCrdtInfoXtrctnTrgtReader" processor="CustCrdtInfoXtrctnCntrCtProcessor"/> -->
<!--             </tasklet> -->
<!--         </step> -->
        
       <!--
		 *    스텝명 : 결과 파일 생성
		 *    설  명 : 출력 파일이 2개인 경우
		-->        
<!--         <step id="CustCrditInfoXtrctnJob_Step06" parent="parentStep"> -->
<!--             <tasklet tm-datasource="BXM"> -->
<!--             	<chunk commit-interval="10" reader="CustCrdtInfoXtrctnTrgtReader" processor="CustCrdtInfoXtrctnTrgtProcessor" writer="CustCrdtInfoXtrctnDlgtWriter" /> -->
<!--             </tasklet> -->
<!--         </step> -->
    </job>
    
    <bean id="CustCrdtInfoXtrctnTrgtReader" parent="RDelimited" scope="step">
        <property name="name" value="CustCrdtInfoXtrctnTrgtReader" />
        <property name="resource" value="file://#{jobParameters[inpFileTrgt]}" />
        <property name="encoding" value="UTF-8" />
        <property name="lineMapper">
            <bean class="bxm.batch.item.file.mapping.LineOmmMapper">
            	<property name="encoding" value="UTF-8" />
                <property name="delimiter" value=";" />
                <property name="targetType" value="bankware.corebanking.customer.open.batch.dto.CustCrdtInfoXtrctnTrgtIO" />
            </bean>
        </property>
	</bean>
	
	<bean id="CustCrdtInfoXtrctnTrgtWriter" parent="WDelimited" scope="step">
        <property name="name" value="CustCrdtInfoXtrctnTrgtWriter" />
        <property name="resource" value="file://#{jobParameters[outpFileTrgt]}" />
        <property name="encoding" value="UTF-8" />
        <property name="lineAggregator">
            <bean class="bxm.batch.item.file.transform.LineOmmAggregator">
                <property name="encoding" value="UTF-8" />
                <property name="delimiter" value="," />
                <property name="targetType" value="bankware.corebanking.customer.open.batch.dto.CustCrdtInfoXtrctnTrgtIO" />
            </bean>
        </property>
	</bean>

    <bean id="CustCrdtInfoXtrctnCmpxReader" parent="RFixed" scope="step">
        <property name="name" value="CustCrdtInfoXtrctnCmpxReader" />
<!-- added -->        
        <property name="headerItemProcessor" ref="CustCrdtInfoXtrctnCmpxttHeaderFooterProcessor" />
        <property name="headerType" value="bankware.corebanking.customer.open.batch.dto.CustCrdtInfoXtrctnHeaderIO" />
        <property name="headerRange" value="9" />
        <property name="footerItemProcessor" ref="CustCrdtInfoXtrctnCmpxttHeaderFooterProcessor" />
        <property name="footerType" value="bankware.corebanking.customer.open.batch.dto.CustCrdtInfoXtrctnFooterIO" />
        <property name="footerRange" value="6" />
<!-- added -->        
        <property name="resource" value="file://#{jobParameters[inpFileCmpx]}" />
        <property name="encoding" value="UTF-8" />
        <property name="itemMapper">
            <bean class="bxm.batch.item.file.mapping.ItemOmmMapper">
            	<property name="encoding" value="UTF-8" />
                <property name="targetType" value="bankware.corebanking.customer.open.batch.dto.CustCrdtInfoXtrctnTrgtIO" />
            </bean>
        </property>
	</bean>
	
	<bean id="CustCrdtInfoXtrctnCmpxWriter" parent="WFixed" scope="step">
        <property name="name" value="CustCrdtInfoXtrctnCmpxWriter" />
<!-- added -->        
        <property name="headerWriter" ref="CustCrdtInfoXtrctnCmpxtHeaderFooterWriter" />
        <property name="footerWriter" ref="CustCrdtInfoXtrctnCmpxtHeaderFooterWriter" />
<!-- added -->        
        <property name="resource" value="file://#{jobParameters[outpFileCmpx]}" />
        <property name="encoding" value="UTF-8" />
        <property name="itemAggregator">
            <bean class="bxm.batch.item.file.transform.ItemOmmAggregator">
                <property name="encoding" value="UTF-8" />
                <property name="targetType" value="bankware.corebanking.customer.open.batch.dto.CustCrdtInfoXtrctnTrgtIO" />
            </bean>
        </property>
	</bean>
	
    <bean id="CustCrdtInfoXtrctnDlgtWriter" class="bankware.corebanking.customer.open.batch.CustCrdtInfoXtrctnDlgtWriter" scope="step">
        <property name="delegates">
            <list>
                <ref bean="CustCrdtInfoXtrctnMlt1Writer" />
                <ref bean="CustCrdtInfoXtrctnMlt2Writer" />
            </list>
        </property>
    </bean>	
	
	<bean id="CustCrdtInfoXtrctnMlt1Writer" parent="WDelimited" scope="step">
        <property name="name" value="CustCrdtInfoXtrctnTrgtWriter" />
        <property name="resource" value="file://#{jobParameters[outpFileMlt1]}" />
        <property name="encoding" value="UTF-8" />
        <property name="lineAggregator">
            <bean class="bxm.batch.item.file.transform.LineOmmAggregator">
                <property name="encoding" value="UTF-8" />
                <property name="delimiter" value="," />
                <property name="targetType" value="bankware.corebanking.customer.open.batch.dto.CustCrdtInfoXtrctnTrgtIO" />
            </bean>
        </property>
	</bean>
	
	<bean id="CustCrdtInfoXtrctnMlt2Writer" parent="WFixed" scope="step">
        <property name="name" value="CustCrdtInfoXtrctnCmpxWriter" />
        <property name="resource" value="file://#{jobParameters[outpFileMlt2]}" />
        <property name="encoding" value="UTF-8" />
        <property name="itemAggregator">
            <bean class="bxm.batch.item.file.transform.ItemOmmAggregator">
                <property name="encoding" value="UTF-8" />
                <property name="targetType" value="bankware.corebanking.customer.open.batch.dto.CustCrdtInfoXtrctnTrgtIO" />
            </bean>
        </property>
	</bean>    
</beans>

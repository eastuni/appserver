<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Product Factory</title>

    <link href="libs/pfui/dpl.css" rel="stylesheet">
    <link href="libs/pfui/pfui.css" rel="stylesheet">
    <link rel="stylesheet" href="libs/font-awesome/css/font-awesome.min.css">
    <link href="/pf_common/style/css/bx-login-style.css" rel="stylesheet">
</head>

<body class="fc-bg fc-body">

    <section id="bx-login-wrap">
        <section class="bx-login-layer">
            <section class="bx-login-layer-body">
                <h1 class="title">Product Factory</h1>

                <table class="login-form-table">
                    <tr>
                        <td colspan="2">
                            Select language
                            <select class="language-select-box">
                                <option value="en">English</option>
                                <option value="cn">China</option>                                
								<option value="ko">Korea</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <label>Institution</label>
                            <!--<input type="text" placeholder="Institution Name" class="institution-name">-->
                            <select class="institution-name">
                                <option value="205">Myanmar JL Group</option>                                
                            </select>
                            <!--<button class="institution-search-btn"></button> -->
                        </td>
                    </tr>
                    <tr>
                        <td class="bx-login-field" colspan="2">
                            <input type="text" class="bx-form-item user-id" name="id" placeholder="ID">
                        </td>
                    </tr>
                    <tr>
                        <td class="bx-login-field" colspan="2">
                            <input type="password" class="bx-form-item" name="pwd" placeholder="Password">
                        </td>
                    </tr>
                    <tr>
                        <td class="bx-login-field bx-operator-filed" colspan="2">
                            <label for="remember-id-check" class="remember-id-label">
                                <input id="remember-id-check" class="bx-form-item" type="checkbox">
                                Remember ID
                            </label>
                            <button type="submit" class="bx-btn bx-btn-primary" id="bx-login-btn">Login</button>
                        </td>
                    </tr>
                </table>
            </section>
            <section class="copyright">
                2018 © BankwareGlobal
            </section>
        </section>
    </section>

    <script src="libs/jquery/jquery.js"></script>
    <script>

        $('input[name=id]').focus();
        rememberIdCheck();

        $('body').on('keydown', function(e) {
            if(e.keyCode === 13)  {
                login();
            }
        });

        $('#bx-login-btn').on('click', login);

        // 01. spring
        function login() {
            var param = {
                commonHeaderMessage: {
                    loginTntInstId: $('.institution-name').val()
                },
                staffId: $('[name=id]').val(),
                passwd: $('[name=pwd]').val()
            };

            $.ajax({
                type: 'post',
                url: 'login.json',
                headers: {
                    'Accept-Language': $('.language-select-box').val()
                },
                cache: false,
                data: JSON.stringify(param),
                contentType: 'application/json',
                success: function(response) {
                    if(response.responseMessage) {
                        var data = response.responseMessage;
                        setCookie('lang'            , $('.language-select-box').val(), 1);
                        setCookie('mother'          , data.mother                    , 1);
                        setCookie('motherTntInstId' , data.motherTntInstId           , 1);
                        setCookie('tntInstId'       , data.tntInstId                 , 1);
                        setCookie('tntInstName'     , $('.institution-name option:selected').text(), 1);
                        setCookie('loginId'         , data.staffId                   , 1);
                        setCookie('loginNm'         , data.staffNm                   , 1);
                        location.pathname = '/main.html';
                    }else {
                        alert('로그인 정보가 틀립니다.');
                    }

                }
            });
        }

        // 02. bxm
//        function login() {
//            var param = {
//                commonHeader: {loginTntInstId: $('.institution-name').val()},
//                staffId: $('[name=id]').val(),
//                passwd: $('[name=pwd]').val()
//            };
//            var bxmParam = {
//                header : {
//                    application : 'PF_Factory',
//                    service : 'LoginProcessService',
//                    operation : 'loginProcess',
//                    locale: $('.language-select-box').val()
//                },
//                input : param
//            };
//
//            $.ajax({
//                type: 'post',
//                url: '/serviceEndpoint/json/request.json',//'login.json',
//                headers: {
//                    'Accept-Language': $('.language-select-box').val()
//                },
//                cache: false,
//                data: JSON.stringify(bxmParam),
//                contentType: 'application/json; charset=UTF-8',
//                success: function(responseData) {
//                    var response = (typeof responseData === 'string') ? JSON.parse(responseData) : responseData;
//                    if(response.responseMessage || response.ModelMap.responseMessage) {
//
//                        var data = response.ModelMap.responseMessage;
//
//                        setCookie('lang'            , $('.language-select-box').val(), 1);
//                        setCookie('mother'          , data.mother                    , 1);
//                        setCookie('motherTntInstId' , data.motherTntInstId           , 1);
//                        setCookie('tntInstId'       , data.tntInstId                 , 1);
//                        setCookie('tntInstName'     ,  $('.institution-name option:selected').text() , 1);
//                        setCookie('loginId'         , data.staffId                   , 1);
//                        setCookie('loginNm'         , data.staffNm                   , 1);
//
//
//                        location.pathname = '/main.html';
//                    }else {
//                        alert('로그인 정보가 틀립니다.');
//                    }
//
//                }
//            });
//        }

        $('#remember-id-check').on('change', function(e){
            if($(e.currentTarget).prop('checked')){
                setCookie('rememberUserId', $('.bx-login-field .user-id').val(),10);
            }
        })

        function rememberIdCheck(){
            if(getCookie('rememberUserId')){
                $('.bx-login-field .user-id').val(getCookie('rememberUserId'));
                $('#remember-id-check').prop('checked', true);
            }

        }

        function setCookie(cName, cValue, cDate){
            var expire = new Date();
            expire.setDate(expire.getDate()+cDate);
            var cookies = cName + '=' + escape(cValue) + '; path=/ ';
            if(typeof cMinute != 'undefined') cookies += ';expires=' + expire.toGMTString() + ';';
            document.cookie = cookies;
        }

        function getCookie(cName) {
            cName = cName + '=';
            var cookieData = document.cookie;
            var start = cookieData.indexOf(cName);
            var cValue = '';
            if(start != -1){
                start += cName.length;
                var end = cookieData.indexOf(';', start);
                if(end == -1)end = cookieData.length;
                cValue = cookieData.substring(start, end);
            }
            return unescape(cValue);
        }

    </script>

</body>
</html>